<!-- This is an online experiment where participants watch videos and press 
the spacebar when they detect an event boundary within multiple violation 
of expectation videos. This will include a welcome screen and example screens, 
followed by training video trials, main video trials and attention check tasks. -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>title</title>
    <link rel="stylesheet" href="../styles.css" />
</head>
<body>
<!-- Generate screen and screenText-->
    <div id="screen">
        <div id="screenText">
            
            <!------------------------>
            <!---- Welcome Screen ---->
            <!------------------------>
 
            <div id="welcome-screen" style="display: block;">
                <h1>Welcome to the experiment!</h1>
                <p>Press the spacebar to continue.</p>
            </div>
            
            <script>
            // Welcome Screen Progresses to Introduction Screen on spacebar press   
            function welcomeScreenHandler(event) {
                const welcomeScreen = document.getElementById("welcome-screen");
                if (event.code === "Space" && welcomeScreen.style.display === 'block') {
                    welcomeScreen.style.display = 'none';
                    document.getElementById('introduction-screen').style.display = 'block';
                    document.removeEventListener('keydown', welcomeScreenHandler);
                    document.addEventListener('keydown', introductionScreenHandler);
                }
            }

            document.addEventListener('keydown', welcomeScreenHandler);
            </script>

            <!------------------------->
            <!-- Introduction Screen -->
            <!------------------------->

            <div id="introduction-screen" style="display: none;">
                <h1>Introduction</h1>
                <p>Press the spacebar to continue.</p>
            </div>

            <script>
            // Introduction Screen Progresses to Example Screen
            function introductionScreenHandler(event) {
                const introductionScreen = document.getElementById("introduction-screen");
                if (event.code === "Space" && introductionScreen.style.display === 'block') {
                    introductionScreen.style.display = 'none';
                    document.getElementById('example-1-screen').style.display = 'block';
                    document.removeEventListener('keydown', introductionScreenHandler);
                    document.addEventListener('keydown', example1ScreenHandler);
                }
            }

            document.eventListener('keydown', introductionScreenHandler);
            </script>
        
            <!-------------------------->
            <!---- Example Screen 1 ---->
            <!-------------------------->

            <div id="example-1-screen" style="display: none;">
                <div>
                    <h1> Example 1 </h1>
                    <p> Watch the following movie </p>
                    <p> Press the spacebar to continue </p>
                </div>
                <div>
                    <video id="example-1-video" width="720" height="480" style="display: none;">
                        <source src="videos/sample_video.mp4" type="video/mp4">
                    </video> 
                    <p id = "example-continue" style="display: none;"> 
                        Press the spacebar to continue.
                    </p>
                </div>

            </div>

            <script>
                document.addEventListener('keydown', example1ScreenHandler);

                function example1ScreenHandler(event) {
                    const example1Screen = document.getElementById("example-1-screen");
                    const example1Video = document.getElementById("example-1-video");
                    if (event.code === "Space" && example1Screen.style.display === 'block') {
                        example1Video.style.display = 'block';
                        document.getElementById('example-1-video').play();
                        document.removeEventListener('keydown', example1ScreenHandler);
                    }
                }

                // example-continue text appears below video when
                var video = document.getElementById("example-1-video");
                video.onended = function(e) {
                    document.getElementById("example-continue").style.display = "block";
                    document.addEventListener('keydown', example1ContinueHandler);
                };

                function example1ContinueHandler(event) {
                    const example1Screen = document.getElementById("example-1-screen");
                    const example1Continue = document.getElementById("example-continue");
                    if (event.code === "Space" && example1Continue.style.display === 'block') {
                        example1Screen.style.display = 'none';
                        document.getElementById('example-2-screen').style.display = 'block';
                        document.removeEventListener('keydown', example1ContinueHandler);
                        document.addEventListener('keydown', example2ScreenHandler);
                    }
                };
            </script>

            <!-------------------------->
            <!---- Example Screen 2 ---->
            <!-------------------------->

            <div id="example-2-screen" style="display: none;">
                <div>
                    <h1> Example 2 </h1>
                    <p> Watch the following movie </p>
                    <p> Press the spacebar to continue </p>
                </div>
                <div>
                    <video id="example-2-video-1" width="720" height="480" style="display: none;">
                        <source src="videos/sample_video.mp4" type="video/mp4">
                    </video> 
                    <p id = "example-2-continue-1" style="display: none;"> 
                        Press the spacebar to continue.
                    </p>
                </div>
                <div>
                    <video id="example-2-video-2" width="720" height="480" style="display: none;">
                        <source src="videos/sample_video.mp4" type="video/mp4">
                    </video> 
                    <p id = "example-2-continue-2" style="display: none;"> 
                        Press the spacebar to continue.
                    </p>
                </div>
                <!-- Now you try -->
                <div>
                    <video id="example-2-video-3" width="720" height="480" style="display: none;">
                        <source src="videos/sample_video.mp4" type="video/mp4">
                    </video> 
                    <p id = "example-2-continue-3" style="display: none;"> 
                        Press the spacebar to continue.
                    </p>
                </div>

            </div>

            <script>
            // spacebar moves to example-2-video-1
            document.addEventListener('keydown', example2ScreenHandler);
            function example2ScreenHandler(event) {
                const example2Screen = document.getElementById("example-2-screen");
                const example2Video1 = document.getElementById("example-2-video-1");
                if (event.code === "Space" && example2Screen.style.display === 'block') {
                    example2Video1.style.display = 'block';
                    document.getElementById('example-2-video-1').play();
                    document.removeEventListener('keydown', example2ScreenHandler);
                }
            }

            // example-2-continue-1 text appears below video when video ends
            var video = document.getElementById("example-2-video-1");
            video.onended = function(e) {
                document.getElementById("example-2-continue-1").style.display = "block";
                document.addEventListener('keydown', example2Continue1Handler);
            };

            function example2Continue1Handler(event) {
                const example2Screen = document.getElementById("example-2-screen");
                const example2Continue1 = document.getElementById("example-2-continue-1");
                if (event.code === "Space" && example2Continue1.style.display === 'block') {
                    example2Continue1.style.display = 'none';
                    document.getElementById('example-2-video-2').style.display = 'block';
                    document.getElementById('example-2-video-2').play();
                    document.removeEventListener('keydown', example2Continue1Handler);
                }
            };

            // example-2-continue-2 text appears below video when video ends
            var video = document.getElementById("example-2-video-2");
            video.onended = function(e) {
                document.getElementById("example-2-continue-2").style.display = "block";
                document.addEventListener('keydown', example2Continue2Handler);
            };

            function example2Continue2Handler(event) {
                const example2Screen = document.getElementById("example-2-screen");
                const example2Continue2 = document.getElementById("example-2-continue-2");
                if (event.code === "Space" && example2Continue2.style.display === 'block') {
                    example2Continue2.style.display = 'none';
                    document.getElementById('example-2-video-3').style.display = 'block';
                    document.getElementById('example-2-video-3').play();
                    document.removeEventListener('keydown', example2Continue2Handler);
                }
            };

            // example-2-continue-3 text appears below video when video ends
            var video = document.getElementById("example-2-video-3");
            video.onended = function(e) {
                document.getElementById("example-2-continue-3").style.display = "block";
                document.addEventListener('keydown', example2Continue3Handler);
            };
            
            // spacebar moves to training screen
            function example2Continue3Handler(event) {
                const example2Screen = document.getElementById("example-2-screen");
                const example2Continue3 = document.getElementById("example-2-continue-3");
                if (event.code === "Space" && example2Continue3.style.display === 'block') {
                    example2Continue3.style.display = 'none';
                    example2Screen.style.display = 'none';
                    document.getElementById('trial-1-screen').style.display = 'block';
                    document.removeEventListener('keydown', example2Continue3Handler);
                    startTrial1();
                }
            };

        </script>   

            <!--------------------------->
            <!------- Main Trials ------->
            <!--------------------------->
            
                <!-- Trial 1 -->

                <div id="trial-1-screen" style="display: none;">
                    <!-- Video Screen-->
                    <div id="video-1-screen">
                        <video id="video1" width="960" height="540" autoplay muted>
                            <source src="videos/sample_video.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-1-screen" style="display: none;">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                    // Start tone trial 1
                    var responses = [];
                    var video = document.getElementById("video1");
                        video.onplay = function(e) {
                        runTrial('video1', 1, responses);
                    };

                    // When video ends, move to progress screen
                    var video = document.getElementById("video1");
                    video.onended = function(e) {
                        document.getElementById("video-1-screen").style.display = "none";
                        document.getElementById("progress-1-screen").style.display = "block";
                        document.addEventListener('keydown', trial1ProgressHandler);
                    };
                    
                    // If spacebar is pressed, and progress screen is displayed, move to trial 2
                    function trial1ProgressHandler(event) {
                        const trial1Screen = document.getElementById("trial-1-screen");
                        const progress1Screen = document.getElementById("progress-1-screen");
                        if (event.code === "Space" && progress1Screen.style.display === 'block') {
                            trial1Screen.style.display = 'none';
                            document.getElementById('trial-2-screen').style.display = 'block';
                            document.removeEventListener('keydown', trial1ProgressHandler);
                            document.addEventListener('keydown', trial2ScreenHandler);
                        }
                    };
                </script>

                <!-- Trial 2 -->

                <div id="trial-2-screen" style="display: none;">
                    <!-- Video Screen-->
                    <div id="video-2-screen">
                        <video id="video2" width="960" height="540" autoplay muted>
                            <source src="videos/sample_video.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-2-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // Start tone trial 2
                var responses = [];
                    var video = document.getElementById("video2");
                        video.onplay = function(e) {
                        runTrial('video2', 2, responses);
                    };
                
                // when video ends, move to progress screen
                var video = document.getElementById("video2");
                video.onended = function(e) {
                    document.getElementById("video-2-screen").style.display = "none";
                    document.getElementById("progress-2-screen").style.display = "block";
                    document.addEventListener('keydown', trial2ProgressHandler);
                };

                // If spacebar is pressed, and progress screen is displayed, move to trial 3
                function trial2ProgressHandler(event) {
                    const trial2Screen = document.getElementById("trial-2-screen");
                    const progress2Screen = document.getElementById("progress-2-screen");
                    if (event.code === "Space" && progress2Screen.style.display === 'block') {
                        trial2Screen.style.display = 'none';
                        document.getElementById('trial-3-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial2ProgressHandler);
                        document.addEventListener('keydown', trial3ScreenHandler);
                    }
                };

                </script>

                <!-- Trial 3 -->

                <div id="trial-3-screen" style="display: none;">
                    <h1>Trial 3</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Video Screen-->
                    <div id="video-3-screen">
                        <video id="video3" width="960" height="540" autoplay muted>
                            <source src="videos/sample_video.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-3-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // Start tone trial 3
                var responses = [];
                    var video = document.getElementById("video3");
                        video.onplay = function(e) {
                        runTrial('video3', 3, responses);
                    };

                // when video ends, move to progress screen
                var video = document.getElementById("video3");
                video.onended = function(e) {
                    document.getElementById("video-3-screen").style.display = "none";
                    document.getElementById("progress-3-screen").style.display = "block";
                    document.addEventListener('keydown', trial3ProgressHandler);
                };

                // If spacebar is pressed, and progress screen is displayed, move to trial 4
                function trial3ProgressHandler(event) {
                    const trial3Screen = document.getElementById("trial-3-screen");
                    const progress3Screen = document.getElementById("progress-3-screen");
                    if (event.code === "Space" && progress3Screen.style.display === 'block') {
                        trial3Screen.style.display = 'none';
                        document.getElementById('trial-4-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial3ProgressHandler);
                        document.addEventListener('keydown', trial4ScreenHandler);
                    }
                };

                </script>

                <!-- Trial 4 -->

                <div id="trial-4-screen" style="display: none;">
                    <h1>Trial 4</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Video Screen-->
                    <div id="video-4-screen">
                        <video id="video4" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-4-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // Start tone trial 4
                var responses = [];
                    var video = document.getElementById("video4");
                        video.onplay = function(e) {
                        runTrial('video4', 4, responses);
                    };

                // when video ends, move to progress screen
                var video = document.getElementById("video4");
                video.onended = function(e) {
                    document.getElementById("video-4-screen").style.display = "none";
                    document.getElementById("progress-4-screen").style.display = "block";
                    document.addEventListener('keydown', trial4ProgressHandler);
                };

                // If spacebar is pressed, and progress screen is displayed, move to attention check 1
                function trial4ProgressHandler(event) {
                    const trial4Screen = document.getElementById("trial-4-screen");
                    const progress4Screen = document.getElementById("progress-4-screen");
                    if (event.code === "Space" && progress4Screen.style.display === 'block') {
                        trial4Screen.style.display = 'none';
                        document.getElementById('attention-check-1-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial4ProgressHandler);
                        document.addEventListener('keydown', attention1ScreenHandler);
                    }
                };
                </script>

                <!-- Attention Check 1 -->

                <div id="attention-check-1-screen" style="display: none;">
                    <!-- Instructions Screen -->
                    <div id="attention-1-instructions-screen" style="display: block;">
                        <h1>Instructions</h1>
                        <p>Press the spacebar to continue.</p>
                    </div>
                    <!-- Bouncing Balls Screen -->
                    <div id="attention-1-balls-screen" style="display: none;">
                    </div>
                    <!-- Progress Screen -->
                    <div id="attention-1-progress-screen" style="display: none;">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                    // Move from instructions screen to bouncing balls screen
    document.addEventListener('keydown', attentionCheck1ScreenHandler);

    function attentionCheck1ScreenHandler(event) {
        const attentionCheck1Screen = document.getElementById("attention-check-1-screen");
        const attention1InstructionsScreen = document.getElementById("attention-1-instructions-screen");
        if (event.code === "Space" && attention1InstructionsScreen.style.display === 'block') {
            attention1InstructionsScreen.style.display = 'none';
            document.getElementById('attention-1-balls-screen').style.display = 'block';
            document.removeEventListener('keydown', attentionCheck1ScreenHandler);
            document.addEventListener('keydown', attentionCheck1BallsHandler);
        }
    }

    function attentionCheck1BallsHandler(event) {
        if (event.code === "Space") {
            // Start the animation when the spacebar is pressed on the instructions screen
            animateBouncingBalls(function(keyPresses, collisionTimes) {
                console.log("Keypresses:", keyPresses);
                console.log("Collision times:", collisionTimes);
                // Display the progress screen after the animation ends
                document.getElementById('attention-1-balls-screen').style.display = 'none';
                document.getElementById('attention-1-progress-screen').style.display = 'block';
            });

            // Remove the event listener after starting the animation
            document.removeEventListener('keydown', attentionCheck1BallsHandler);
        }
    }
                </script>

                <!-- Trial 5 -->

                <div id="trial-5-screen" style="display: none;">
                    <h1>Trial 5</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Video Screen-->
                    <div id="video-5-screen">
                        <video id="video5" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-5-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // Start tone trial 5
                var responses = [];
                    var video = document.getElementById("video5");
                        video.onplay = function(e) {
                        runTrial('video5', 5, responses);
                    };

                // If spacebar is pressed, and progress screen is displayed, move to trial 6
                function trial5ProgressHandler(event) {
                    const trial5Screen = document.getElementById("trial-5-screen");
                    const progress5Screen = document.getElementById("progress-5-screen");
                    if (event.code === "Space" && progress5Screen.style.display === 'block') {
                        trial5Screen.style.display = 'none';
                        document.getElementById('trial-6-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial5ProgressHandler);
                        document.addEventListener('keydown', trial6ScreenHandler);
                    }
                };

                </script>

                <!-- Trial 6 -->

                <div id="trial-6-screen" style="display: none;">
                    <h1>Trial 6</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Video Screen-->
                    <div id="video-6-screen">
                        <video id="video6" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-6-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // Start tone trial 6
                var responses = [];
                    var video = document.getElementById("video6");
                        video.onplay = function(e) {
                        runTrial('video6', 6, responses);
                    };

                // If spacebar is pressed, and progress screen is displayed, move to trial 7
                function trial6ProgressHandler(event) {
                    const trial6Screen = document.getElementById("trial-6-screen");
                    const progress6Screen = document.getElementById("progress-6-screen");
                    if (event.code === "Space" && progress6Screen.style.display === 'block') {
                        trial6Screen.style.display = 'none';
                        document.getElementById('trial-7-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial6ProgressHandler);
                        document.addEventListener('keydown', trial7ScreenHandler);
                    }
                };

                </script>

                <!-- Trial 7 -->

                <div id="trial-7-screen" style="display: none;">
                    <h1>Trial 7</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Video Screen-->
                    <div id="video-7-screen">
                        <video id="video7" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-7-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>               
                // Start tone trial 7
                var responses = [];
                    var video = document.getElementById("video7");
                        video.onplay = function(e) {
                        runTrial('video7', 7, responses);
                    };

                // If spacebar is pressed, and progress screen is displayed, move to trial 8
                function trial7ProgressHandler(event) {
                    const trial7Screen = document.getElementById("trial-7-screen");
                    const progress7Screen = document.getElementById("progress-7-screen");
                    if (event.code === "Space" && progress7Screen.style.display === 'block') {
                        trial7Screen.style.display = 'none';
                        document.getElementById('trial-8-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial7ProgressHandler);
                        document.addEventListener('keydown', trial8ScreenHandler);
                    }
                };

                </script>               
                
                <!-- Trial 8 -->

                <div id="trial-8-screen" style="display: none;">
                    <h1>Trial 8</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Video Screen-->
                    <div id="video-8-screen">
                        <video id="video8" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-8-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // Start tone trial 8
                var responses = [];
                    var video = document.getElementById("video8");
                        video.onplay = function(e) {
                        runTrial('video8', 8, responses);
                    };

                // If spacebar is pressed, and progress screen is displayed, move to trial 9
                function trial8ProgressHandler(event) {
                    const trial8Screen = document.getElementById("trial-8-screen");
                    const progress8Screen = document.getElementById("progress-8-screen");
                    if (event.code === "Space" && progress8Screen.style.display === 'block') {
                        trial8Screen.style.display = 'none';
                        document.getElementById('trial-9-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial8ProgressHandler);
                        document.addEventListener('keydown', trial9ScreenHandler);
                    }
                };

                </script>

                <!-- Trial 9 -->

                <div id="trial-9-screen" style="display: none;">
                    <h1>Trial 9</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Video Screen-->
                    <div id="video-9-screen">
                        <video id="video9" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-9-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // Start tone trial 9
                var responses = [];
                    var video = document.getElementById("video9");
                        video.onplay = function(e) {
                        runTrial('video9', 9, responses);
                    };

                // If spacebar is pressed, and progress screen is displayed, move to trial 10
                function trial9ProgressHandler(event) {
                    const trial9Screen = document.getElementById("trial-9-screen");
                    const progress9Screen = document.getElementById("progress-9-screen");
                    if (event.code === "Space" && progress9Screen.style.display === 'block') {
                        trial9Screen.style.display = 'none';
                        document.getElementById('attention-check-2-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial9ProgressHandler);
                        document.addEventListener('keydown', attention2ScreenHandler);
                    }
                };

                </script>

                <!-- Attention Check 2 -->

                <div id="attention-check-2-screen" style="display: none;">
                    <h1>Attention Check 2</h1>
                    <p>Press the spacebar to continue.</p>
                    <!-- Instructions Screen -->
                    <div id="instructions-screen">
                        <h1>Instructions</h1>
                        <p>Press the spacebar to continue.</p>
                    </div>
                    <!-- Bouncing Balls Screen -->
                    <div id="bouncing-balls-screen">
                        <h1>Bouncing Balls</h1>
                        <p>Press the spacebar to continue.</p>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-screen">
                        <h1>Progress</h1>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <!-- Trial 10 -->

                <div id="trial-10-screen" style="display: none;">
                    <h1>Trial 10</h1>
                    <!-- Video Screen-->
                    <div id="video-10-screen">
                        <video id="video10" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-10-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // automatically start the tenth trial when the page loads
                window.onload = function() {
                    startTrial10();
                };

                function startTrial10() {
                    const trial10Screen = document.getElementById("trial-10-screen");
                    const video10Screen = document.getElementById("video-10-screen");
                    const progress10Screen = document.getElementById("progress-10-screen");

                    // Hide first screen
                    trial10Screen.style.display = 'none';
                    // Show video screen
                    video10Screen.style.display = 'block';

                    // Run the trials
                    startTrial('video10', function (responses) {
                        console.log('Trial 10 responses:', responses);
                        document.getElementById("progress-10-screen").style.display = "block";
                        document.getElementById("video-10-screen").style.display = "none";
                        document.addEventListener('keydown', trial10ProgressHandler);
                    });
                }

                // If spacebar is pressed, and progress screen is displayed, move to trial 11
                function trial10ProgressHandler(event) {
                    const trial10Screen = document.getElementById("trial-10-screen");
                    const progress10Screen = document.getElementById("progress-10-screen");
                    if (event.code === "Space" && progress10Screen.style.display === 'block') {
                        trial10Screen.style.display = 'none';
                        document.getElementById('attention-check-3-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial10ProgressHandler);
                        document.addEventListener('keydown', attention3ScreenHandler);
                    }
                };

                </script>

                <!-- Trial 11 -->

                <div id="trial-11-screen" style="display: none;">
                    <h1>Trial 11</h1>
                    <!-- Video Screen-->
                    <div id="video-11-screen">
                        <video id="video11" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-11-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // automatically start the eleventh trial when the page loads
                window.onload = function() {
                    startTrial11();
                };

                function startTrial11() {
                    const trial11Screen = document.getElementById("trial-11-screen");
                    const video11Screen = document.getElementById("video-11-screen");
                    const progress11Screen = document.getElementById("progress-11-screen");

                    // Hide first screen
                    trial11Screen.style.display = 'none';
                    // Show video screen
                    video11Screen.style.display = 'block';

                    // Run the trials
                    startTrial('video11', function (responses) {
                        console.log('Trial 11 responses:', responses);
                        document.getElementById("progress-11-screen").style.display = "block";
                        document.getElementById("video-11-screen").style.display = "none";
                        document.addEventListener('keydown', trial11ProgressHandler);
                    });
                }

                // If spacebar is pressed, and progress screen is displayed, move to trial 12
                function trial11ProgressHandler(event) {
                    const trial11Screen = document.getElementById("trial-11-screen");
                    const progress11Screen = document.getElementById("progress-11-screen");
                    if (event.code === "Space" && progress11Screen.style.display === 'block') {
                        trial11Screen.style.display = 'none';
                        document.getElementById('attention-check-4-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial11ProgressHandler);
                        document.addEventListener('keydown', attention4ScreenHandler);
                    }
                };

                </script>

                <!-- Trial 12 -->

                <div id="trial-12-screen" style="display: none;">
                    <h1>Trial 12</h1>
                    <!-- Video Screen-->
                    <div id="video-12-screen">
                        <video id="video12" width="960" height="540">
                            <source src="videos.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Progress Screen -->
                    <div id="progress-12-screen">
                        <h1>Progress</h1>
                        <!-- displays a progress bar -->
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p>Press the spacebar to continue.</p>
                    </div>
                </div>

                <script>
                // automatically start the twelfth trial when the page loads
                window.onload = function() {
                    startTrial12();
                };

                function startTrial12() {
                    const trial12Screen = document.getElementById("trial-12-screen");
                    const video12Screen = document.getElementById("video-12-screen");
                    const progress12Screen = document.getElementById("progress-12-screen");

                    // Hide first screen
                    trial12Screen.style.display = 'none';
                    // Show video screen
                    video12Screen.style.display = 'block';

                    // Run the trials
                    startTrial('video12', function (responses) {
                        console.log('Trial 12 responses:', responses);
                        document.getElementById("progress-12-screen").style.display = "block";
                        document.getElementById("video-12-screen").style.display = "none";
                        document.addEventListener('keydown', trial12ProgressHandler);
                    });
                }

                // If spacebar is pressed, and progress screen is displayed, move to trial 13
                function trial12ProgressHandler(event) {
                    const trial12Screen = document.getElementById("trial-12-screen");
                    const progress12Screen = document.getElementById("progress-12-screen");
                    if (event.code === "Space" && progress12Screen.style.display === 'block') {
                        trial12Screen.style.display = 'none';
                        document.getElementById('attention-check-5-screen').style.display = 'block';
                        document.removeEventListener('keydown', trial12ProgressHandler);
                        document.addEventListener('keydown', attention5ScreenHandler);
                    }
                };

                </script>  
    </div>

               <!-------------------------------->
            <!--- Main Trials Data Manager --->
            <!-------------------------------->
            
            <script>
                // Data Manager - stores data from each trial in an array - collects time of 'F or J' press, whether correct (F for 550hz, J for 700hz), time within video, last presented tone frequency, current video ID and current trial number
                var dataManager = function() {
                    var data = [];
                    var trialNumber = 1;
                    var videoID = 1;
                    var toneFrequency = 550;
                    var timeWithinVideo = 0;
                    var timeOfPress = 0;
                    var correct = false;
                    var addData = function() {
                        data.push({
                            trialNumber: trialNumber,
                            videoID: videoID,
                            toneFrequency: toneFrequency,
                            timeWithinVideo: timeWithinVideo,
                            timeOfPress: timeOfPress,
                            correct: correct
                        });
                    };
                    var getTrialNumber = function() {
                        return trialNumber;
                    };
                    var getVideoID = function() {
                        return videoID;
                    };
                    var getToneFrequency = function() {
                        return toneFrequency;
                    };
                    var getTimeWithinVideo = function() {
                        return timeWithinVideo;
                    };
                    var getTimeOfPress = function() {
                        return timeOfPress;
                    };
                    var getCorrect = function() {
                        return correct;
                    };
                    var setTrialNumber = function(newTrialNumber) {
                        trialNumber = newTrialNumber;
                    };
                    var setVideoID = function(newVideoID) {
                        videoID = newVideoID;
                    };
                    var setToneFrequency = function(newToneFrequency) {
                        toneFrequency = newToneFrequency;
                    };
                    var setTimeWithinVideo = function(newTimeWithinVideo) {
                        timeWithinVideo = newTimeWithinVideo;
                    };
                    var setTimeOfPress = function(newTimeOfPress) {
                        timeOfPress = newTimeOfPress;
                    };
                    var setCorrect = function(newCorrect) {
                        correct = newCorrect;
                    };
                    return {
                        addData: addData,
                        getTrialNumber: getTrialNumber,
                        getVideoID: getVideoID,
                        getToneFrequency: getToneFrequency,
                        getTimeWithinVideo: getTimeWithinVideo,
                        getTimeOfPress: getTimeOfPress,
                        getCorrect: getCorrect,
                        setTrialNumber: setTrialNumber,
                        setVideoID: setVideoID,
                        setToneFrequency: setToneFrequency,
                        setTimeWithinVideo: setTimeWithinVideo,
                        setTimeOfPress: setTimeOfPress,
                        setCorrect: setCorrect
                    };
                };
                </script>
    
                <!-------------------------------->
                <!----- Attention check code ----->
                <!-------------------------------->
                
                <script> 
                  
    // BALL ANIMATIONS CODE //
    function animateBouncingBalls(callback) {
        const canvasContainer = document.querySelector('#canvas-container');
        const canvas = document.createElement('canvas');
        canvas.id = 'attentionCheckCanvas';
        canvas.width = 800;
        canvas.height = 600;
        canvasContainer.appendChild(canvas);
    
    // Event Listeners
    let keyPresses = [];
        function keyDownHandler(event) {
            if (event.key === 'f' || event.key === 'F' || event.key === 'j' || event.key === 'J') {
                const keyPress = { key: event.key.toLowerCase(), time: new Date().getTime() };
                keyPresses.push(keyPress);
                console.log('Keypress:', keyPress); // Log the keypress to the console
            }
        }
    
    document.addEventListener('keydown', keyDownHandler);
    
    let collisionTimes = {
        ballWall: [],
        ballBall: [],
    };
    
    function task1() {
        for (let i = 0; i < balls.length; i++) {
            const ball = balls[i];
    
            // Ball-wall collision
            if (
                ball.x - ball.radius <= 0 ||
                ball.x + ball.radius >= canvas.width ||
                ball.y - ball.radius <= 0 ||
                ball.y + ball.radius >= canvas.height
            ) {
                const ballWallCollisionTime = new Date().getTime();
                collisionTimes.ballWall.push(ballWallCollisionTime);
                console.log('Ball-wall collision:', ballWallCollisionTime); // Log the collision time to the console
            }
    
            // Ball-ball collision
            for (let j = i + 1; j < balls.length; j++) {
                if (detectCollision(ball, balls[j])) {
                    const ballBallCollisionTime = new Date().getTime();
                    collisionTimes.ballBall.push(ballBallCollisionTime);
                    console.log('Ball-ball collision:', ballBallCollisionTime); // Log the collision time to the console
                }
            }
        }
    }
    
    
            class Ball {
                constructor(x, y, radius, dx, dy, color) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.dx = dx;
                this.dy = dy;
                this.color = color;
                }
    
                draw(ctx) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    ctx.closePath();
                }
    
                update(canvas) {
                    if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
                        this.dx = -this.dx;
                        }
    
                    if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
                        this.dy = -this.dy;
                        }
    
                    this.x += this.dx;
                    this.y += this.dy;
                }
    
                animate(ctx, canvas) {
                    this.x += this.dx;
                    this.y += this.dy;
    
                    if (this.x - this.radius < 0 || this.x + this.radius > canvas.width) {
                        this.dx = -this.dx;
                    }
    
                    if (this.y - this.radius < 0 || this.y + this.radius > canvas.height) {
                        this.dy = -this.dy;
                    }
    
                    this.draw(ctx);
                }
            }
                 
        const ctx = canvas.getContext("2d");
      
        function detectCollision(ball1, ball2) {
            const dx = ball1.x - ball2.x;
            const dy = ball1.y - ball2.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance < ball1.radius + ball2.radius;
            }
    
            const ball1 = new Ball(100, 100, 20, 2, 3, "red");
            const ball2 = new Ball(200, 200, 20, -2, -3, "blue");
            const ball3 = new Ball(300, 150, 20, 3, 2, "green");
            const balls = [ball1, ball2, ball3];
    
            const colors = ["red", "blue", "green"];
    
        function changeColor(ball) {
            const currentColorIndex = colors.indexOf(ball.color);
        
            let newColorIndex;
                do {
                newColorIndex = Math.floor(Math.random() * colors.length);
                } while (newColorIndex === currentColorIndex);
    
            ball.color = colors[newColorIndex];
        }
    
    let lastCollisionTime = null;
    
    function resolveCollision(ball1, ball2) {
        const dx = ball2.x - ball1.x;
        const dy = ball2.y - ball1.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
    
        if (distance < ball1.radius + ball2.radius) {
            // Calculate the unit vector of the collision normal
            const nx = dx / distance;
            const ny = dy / distance;
    
            // Calculate the relative velocity of the balls
            const dvx = ball2.dx - ball1.dx;
            const dvy = ball2.dy - ball1.dy;
            const dotProduct = dvx * nx + dvy * ny;
    
            // Calculate the impulse scalar
            const mass1 = Math.PI * ball1.radius ** 2;
            const mass2 = Math.PI * ball2.radius ** 2;
            const impulse = (2 * dotProduct) / (mass1 + mass2);
    
            // Apply the impulse to the velocities
            ball1.dx += impulse * nx * mass2;
            ball1.dy += impulse * ny * mass2;
            ball2.dx -= impulse * nx * mass1;
            ball2.dy -= impulse * ny * mass1;
    
            // Separate the balls along the collision normal
            const overlap = ball1.radius + ball2.radius - distance;
            ball1.x -= overlap * nx * 0.5;
            ball1.y -= overlap * ny * 0.5;
            ball2.x += overlap * nx * 0.5;
            ball2.y += overlap * ny * 0.5;
        }
    }
    
    let animationId;
    
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    
        for (const ball of balls) {
            ball.animate(ctx, canvas);
        }
    
        for (let i = 0; i < balls.length; i++) {
            for (let j = i + 1; j < balls.length; j++) {
                if (detectCollision(balls[i], balls[j])) {
                    resolveCollision(balls[i], balls[j]);
                }
            }
        }
    
    task1(); // Call task1() to update collisionTimes
    
    animationId = requestAnimationFrame(draw); 
    }
    
    draw();
    
    
    function endTask() {
        cancelAnimationFrame(animationId);
        canvasContainer.removeChild(canvas);
        document.removeEventListener('keydown', keyDownHandler);
        callback(keyPresses, collisionTimes);
    }
    
    setTimeout(endTask, 20000);
    };
                </script>

                <!---------------------------->
                <!------ Tone Generator ------>
                <!---------------------------->

                <script>
                // Tone Generator - produces 300ms tones randomly at either 550hz or 700hz - tones presented every second (with 700ms silence in between) - tones continue for duration of current video file
                var toneGenerator = function() {
                    var context = new AudioContext();
                    var oscillator = context.createOscillator();
                    var gainNode = context.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    gainNode.gain.value = 0;
                    oscillator.frequency.value = 550;
                    oscillator.start();
                    var interval = setInterval(function() {
                        var random = Math.random();
                        if (random < 0.5) {
                            oscillator.frequency.value = 550;
                        } else {
                            oscillator.frequency.value = 700;
                        }
                        gainNode.gain.value = 1;
                        setTimeout(function() {
                            gainNode.gain.value = 0;
                        }, 300);
                    }, 1000);
                    return interval;
                };
    
    // Function for presenting tones during video playback
    async function startTrial(videoId, callback) {
        var toneInterval;
        var video = document.getElementById(videoId);
        var userResponses = [];
    
        function keyDownHandler(event) {
            if (event.key === 'f' || event.key === 'F' || event.key === 'j' || event.key === 'J') {
                var response = {
                    key: event.key.toLowerCase(),
                    time: new Date().getTime(),
                };
                userResponses.push(response);
            }
        }
    
        document.addEventListener('keydown', keyDownHandler);
    
        await new Promise((resolve) => {
            video.oncanplaythrough = function () {
                resolve();
            };
        });
    
        video.onplay = function () {
            toneInterval = toneGenerator();
            video.play();
        };
    
        await new Promise((resolve) => {
            video.onended = function () {
                resolve();
            };
        });
    
        clearInterval(toneInterval);
        document.removeEventListener('keydown', keyDownHandler);
        callback(userResponses);
    }
                </script>

<script>
    // create an audio context
    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // define function to handle keydown events and log responses
    function keyDownHandler(event, trialNum, toneStartTime, toneFrequency, userResponses) {
        // check if F or J key is pressed
        if (event.key === 'f' || event.key === 'F' || event.key === 'j' || event.key === 'J') {
            var response = {
                key: event.key.toLowerCase(),
                time: new Date().getTime(),
                toneTime: toneStartTime,
                toneFrequency: toneFrequency,
                trialNum: trialNum
            };
            console.log(response);
            userResponses.push(response);
        }
    }

    // function to play a tone of a specified frequency and duration
    function playTone(frequency, duration, trialNum, userResponses) {
        // set tone start time and frequency
        var toneStartTime = new Date().getTime();
        var toneFrequency = frequency;

        var oscillator = audioCtx.createOscillator();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
        oscillator.connect(audioCtx.destination);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + duration / 1000);

        // add keydown event listener to document
        document.addEventListener('keydown', function(event) {
            keyDownHandler(event, trialNum, toneStartTime, toneFrequency, userResponses);
        });
    }

    // function to run a trial
    function runTrial(videoId, trialNum, userResponses) {
        var video = document.getElementById(videoId);

        var intervalID = setInterval(function() {
            var random = Math.random();
            if (random < 0.5) {
                playTone(440, 300, trialNum, userResponses);
            } else {
                playTone(540, 300, trialNum, userResponses);
            }
        }, 1000);

        video.addEventListener('ended', function() {
            clearInterval(intervalID);
        });
    }
</script>

</body>
</html>
